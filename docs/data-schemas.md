Yes, here is the `03-DATA_SCHEMA.md` file. This document serves as the "contract" for your data, ensuring that the Python backend, Firebase, and MQTT all speak the same language.

-----

### **Filename:** `03-DATA_SCHEMA.md`

````markdown
# Data Schema & Message Formats

## 1. MQTT Telemetry Payload
**Topic:** `cs335/bese13ab/sensor_data`
**Frequency:** 1 Hz (Every Real Second)
**Direction:** Python Publisher $\to$ Web Subscriber
**Format:** JSON

This payload drives the real-time animation on the "Digital Twin" dashboard.

```json
{
  "moisture": 74.5,          // Float (0.0 - 100.0)
  "temperature": 26.2,       // Float (Celsius)
  "light_intensity": 800,    // Integer (Lux approximation)
  "hour": 14,                // Integer (0-23)
  "minute": 30,              // Integer (0-59)
  "time_str": "14:30",       // String (Display formatted)
  "day_progress": 60.4,      // Float (0.0 - 100.0) -> Used for Sun Position
  "is_day": true,            // Boolean -> Used for Sky Color (Blue/Black)
  "prediction": "2h 15m",    // String -> ML Output "Time to Empty"
  "sprinkler_on": false      // Boolean -> Visual feedback state
}
````

-----

## 2\. Firebase Database Structure

**URL:** `https://<YOUR-PROJECT-ID>.firebaseio.com/`
**Root Node:** `plant_monitor`

The database is split into two distinct branches: `actuators` (for control) and `history_log` (for analysis).

### Branch A: `/plant_monitor/actuators/`

Used for bidirectional control. The Web UI writes to it; the Python script reads from it.

```json
{
  "sprinkler_state": false,  // Boolean: true = ON, false = OFF
  "grow_light_state": false, // Boolean: true = ON, false = OFF
  "fan_state": false         // Boolean: true = ON, false = OFF
}
```

### Branch B: `/plant_monitor/history_log/`

Used for storing long-term data points to generate the "Environmental Trends" charts.
**Write Frequency:** Once per **Virtual Hour** (every 10 real seconds).

```json
{
  "-NxyzRandomID1": {       // Unique Push ID generated by Firebase
    "time": "06:00",        // String: Timestamp of the log
    "moisture": 80.5,       // Float: Recorded moisture
    "temperature": 18.2     // Float: Recorded temperature
  },
  "-NxyzRandomID2": {
    "time": "07:00",
    "moisture": 79.1,
    "temperature": 19.5
  }
}
```

-----

## 3\. Machine Learning Data Buffer (Internal Python)

This is not stored in a database but is a runtime data structure used by the Python script to train the Linear Regression model.

**Structure:** List of Tuples `[(x, y), ...]`

  * **x (Feature):** `time_index` (Cumulative virtual minutes passed since start).
  * **y (Target):** `moisture_level` (Current sensor reading).

**Example Buffer:**

```python
[
  (0, 80.0),   # 06:00 AM
  (60, 79.2),  # 07:00 AM
  (120, 78.1), # 08:00 AM
  ...
]
